# Requirements Archive: v1.2 Auth.js v5 Migration

**Archived:** 2026-01-23
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.2.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: HabitStreak v1.2

**Defined:** 2026-01-19
**Core Value:** Make every interaction feel rewarding.

## v1.2 Requirements

Requirements for Auth.js v5 migration milestone.

### Authentication Migration

- [x] **AUTH-01**: Install next-auth@beta package and update dependencies
- [x] **AUTH-02**: Create edge-compatible auth.config.ts if needed for middleware
- [x] **AUTH-03**: Rewrite auth.ts with v5 export pattern (handlers, signIn, signOut, auth)
- [x] **AUTH-04**: Update API route handler to use new exports
- [x] **AUTH-05**: Update middleware to use auth export
- [x] **AUTH-06**: Update auth-helpers.ts to use auth() instead of getServerSession
- [x] **AUTH-07**: Update environment variables (AUTH_SECRET, AUTH_TRUST_HOST)
- [x] **AUTH-08**: Update TypeScript type declarations for v5

### Dynamic URL Detection

- [x] **URL-01**: Configure trustHost: true for automatic URL detection
- [x] **URL-02**: Login works on localhost:3000
- [x] **URL-03**: Login works on 127.0.0.1:3000
- [x] **URL-04**: Login works on LAN IP address
- [x] **URL-05**: Proper X-Forwarded-Host/Proto header support for reverse proxy
- [x] **URL-06**: Login works on any custom domain via Host header

## v2 Requirements

*None — this milestone is tightly scoped to Auth.js v5 migration only.*

## Out of Scope

| Feature | Reason |
|---------|--------|
| Cookie migration | Complexity not worth it for small user base — users re-login once after upgrade |
| Reverse proxy configuration | Code enables capability; actual nginx/traefik setup is deployment task |
| OAuth providers | Credentials-only auth sufficient for personal self-hosted app |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| AUTH-01 | Phase 9 | Complete |
| AUTH-02 | Phase 9 | Complete |
| AUTH-03 | Phase 9 | Complete |
| AUTH-04 | Phase 9 | Complete |
| AUTH-05 | Phase 9 | Complete |
| AUTH-06 | Phase 9 | Complete |
| AUTH-07 | Phase 9 | Complete |
| AUTH-08 | Phase 9 | Complete |
| URL-01 | Phase 9 | Complete |
| URL-02 | Phase 9 | Complete |
| URL-03 | Phase 9 | Complete |
| URL-04 | Phase 9 | Complete |
| URL-05 | Phase 9 | Complete |
| URL-06 | Phase 9 | Complete |

**Coverage:**
- v1.2 requirements: 14 total
- Mapped to phases: 14
- Unmapped: 0 ✓

---

## Milestone Summary

**Shipped:** 14 of 14 v1.2 requirements

**Validation Outcomes:**
- AUTH-01 through AUTH-08: All validated via code inspection and TypeScript compilation ✓
- URL-01: Validated via auth.config.ts configuration ✓
- URL-02, URL-03, URL-04: Validated via manual browser testing during Phase 9 execution ✓
- URL-05: Validated via trustHost configuration (enables X-Forwarded-* header support) ✓
- URL-06: Validated via trustHost configuration (code ready, requires domain setup to fully test) ✓

**Adjusted:** None - all requirements delivered as specified

**Dropped:** None - all 14 requirements completed

**Notes:**
- URL-02, URL-03, URL-04 were manually verified during Phase 9 Plan 02 human checkpoint
- URL-06 (custom domain) verified at code level; full verification requires actual domain configuration
- Zero regression: All existing auth functionality (rate limiting, credential validation, protected routes) preserved

---
*Archived: 2026-01-23 as part of v1.2 milestone completion*
