---
phase: 14-landing-page-install
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/pwa/share-icon.tsx
  - src/components/pwa/ios-walkthrough-modal.tsx
  - src/components/pwa/install-banner.tsx
  - src/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "Visitor on Android Chrome sees install banner with 'Installeren' button"
    - "Visitor on iOS Safari sees install banner with 'Zo werkt het' button"
    - "iOS user clicking 'Zo werkt het' sees 3-step walkthrough modal"
    - "Android user clicking 'Installeren' triggers native install prompt"
    - "User clicking dismiss hides banner permanently"
    - "Banner appears after 2.5 second delay with slide-up animation"
  artifacts:
    - path: "src/components/pwa/share-icon.tsx"
      provides: "iOS-matching share icon SVG"
      exports: ["IosShareIcon"]
    - path: "src/components/pwa/ios-walkthrough-modal.tsx"
      provides: "3-step iOS Add to Home Screen walkthrough"
      exports: ["IosWalkthroughModal"]
    - path: "src/components/pwa/install-banner.tsx"
      provides: "Fixed bottom install banner with platform detection"
      exports: ["InstallBanner"]
    - path: "src/app/page.tsx"
      provides: "Landing page with InstallBanner integrated"
      contains: "<InstallBanner"
  key_links:
    - from: "src/components/pwa/install-banner.tsx"
      to: "src/contexts/pwa-install-context.tsx"
      via: "usePwaInstall hook import"
      pattern: "usePwaInstall.*canInstall.*platform"
    - from: "src/components/pwa/install-banner.tsx"
      to: "src/components/pwa/ios-walkthrough-modal.tsx"
      via: "import and render"
      pattern: "IosWalkthroughModal"
    - from: "src/app/page.tsx"
      to: "src/components/pwa/install-banner.tsx"
      via: "import and render"
      pattern: "InstallBanner"
---

<objective>
Create the PWA install banner UI for the landing page with platform-specific actions and iOS walkthrough modal.

Purpose: Enable first-time visitors to discover and install the PWA with a subtle, helpful banner that appears after page load, providing platform-appropriate install actions.

Output: InstallBanner component with delayed slide-up animation, IosWalkthroughModal with 3-step instructions, and landing page integration.
</objective>

<execution_context>
@/home/pvdochtend/.claude/get-shit-done/workflows/execute-plan.md
@/home/pvdochtend/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-landing-page-install/14-CONTEXT.md
@.planning/phases/14-landing-page-install/14-RESEARCH.md

# Infrastructure from Phase 13
@src/contexts/pwa-install-context.tsx

# Existing components to use
@src/components/ui/dialog.tsx
@src/components/ui/button.tsx

# Integration target
@src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create iOS Walkthrough Modal Components</name>
  <files>
    src/components/pwa/share-icon.tsx
    src/components/pwa/ios-walkthrough-modal.tsx
  </files>
  <action>
Create directory `src/components/pwa/` if it doesn't exist.

**share-icon.tsx:**
Create an SVG icon component matching iOS SF Symbols "square.and.arrow.up" (the iOS share icon). This helps users recognize the familiar Safari share button in the walkthrough.

```tsx
export function IosShareIcon({ className }: { className?: string })
```

Use:
- SVG viewBox="0 0 24 24"
- Arrow pointing up from a rounded rectangle (open top)
- stroke="currentColor", strokeWidth={2}, strokeLinecap="round", strokeLinejoin="round"

**ios-walkthrough-modal.tsx:**
Create a modal showing 3 steps for iOS Safari Add to Home Screen process.

```tsx
interface IosWalkthroughModalProps {
  open: boolean
  onClose: () => void
}

export function IosWalkthroughModal({ open, onClose }: IosWalkthroughModalProps)
```

Implementation:
- Use existing Dialog, DialogContent, DialogHeader, DialogTitle from `@/components/ui/dialog`
- Dutch title: "Voeg toe aan beginscherm"
- 3 steps with numbered circles (bg-primary/10, text-primary):
  1. IosShareIcon + "Tik op het **Deel** icoon in Safari"
  2. ArrowDown icon (lucide-react) + "Scroll naar beneden in het menu"
  3. PlusSquare icon (lucide-react) + "Tik op **Zet op beginscherm**"
- Create internal WalkthroughStep component for consistent step styling
- Each step: flex with number badge (w-8 h-8), icon, and text
- Add close button via DialogContent's onClose prop
- max-w-sm for compact mobile display

All text in Dutch, matching existing app language conventions.
  </action>
  <verify>
- `npm run lint` passes
- `npm run build` compiles without errors
- Files exist at specified paths
- Modal uses existing Dialog component (not custom portal)
  </verify>
  <done>
- IosShareIcon renders iOS-recognizable share icon SVG
- IosWalkthroughModal shows 3-step Dutch instructions
- Modal can be opened and closed via props
  </done>
</task>

<task type="auto">
  <name>Task 2: Create InstallBanner and Integrate in Landing Page</name>
  <files>
    src/components/pwa/install-banner.tsx
    src/app/page.tsx
  </files>
  <action>
**install-banner.tsx:**
Create fixed bottom banner that appears after 2.5s delay with platform-specific CTA.

```tsx
export function InstallBanner()
```

Implementation:
1. **Hook consumption:**
   - Import usePwaInstall from `@/contexts/pwa-install-context`
   - Destructure: platform, canInstall, isLoading, triggerInstall, dismiss

2. **State:**
   - `isVisible` boolean (controls render)
   - `showWalkthrough` boolean (controls iOS modal)

3. **Visibility logic (useEffect):**
   - When !isLoading && canInstall -> setIsVisible(true)
   - Banner shows ONLY when canInstall is true (hook handles dismissed/standalone checks)

4. **Styling (fixed bottom banner):**
   - `fixed bottom-0 left-0 right-0 z-40 p-4 pb-safe` (safe area for iPhone home indicator)
   - `animate-slide-up` with inline style `{ animationDelay: '2.5s', animationFillMode: 'backwards' }`
   - Inner container: `glass-subtle rounded-lg p-4 flex items-center gap-4 max-w-lg mx-auto`

5. **Content:**
   - Left side (flex-1):
     - "Installeer de app" (text-sm font-medium)
     - Platform subtitle (text-xs text-muted-foreground):
       - iOS: "Voeg toe aan je beginscherm"
       - Chromium: "Snelle toegang vanaf je beginscherm"

6. **Actions:**
   - Primary Button (size="sm", touch-target class):
     - iOS: "Zo werkt het" -> onClick: setShowWalkthrough(true)
     - Chromium: "Installeren" -> onClick: handleInstall (calls triggerInstall, hides on accept)
   - Dismiss button:
     - X icon (lucide-react) + "Niet nu" text
     - `touch-target flex items-center gap-1 text-muted-foreground hover:text-foreground transition-colors`
     - onClick: setIsVisible(false) then await dismiss()

7. **Handlers:**
   - handleInstall: if iOS show walkthrough, else await triggerInstall() and hide on accept
   - handleDismiss: setIsVisible(false), await dismiss()

8. **iOS Modal:** Render IosWalkthroughModal with open={showWalkthrough} onClose={() => setShowWalkthrough(false)}

**page.tsx:**
Import and add InstallBanner at the bottom of the landing page (inside main, after the content div).

```tsx
import { InstallBanner } from '@/components/pwa/install-banner'

// At the end of the return, before closing </main>:
<InstallBanner />
```

The banner is self-contained (handles its own visibility via usePwaInstall hook).
  </action>
  <verify>
- `npm run lint` passes
- `npm run build` compiles without errors
- `npm run dev` starts without errors
- Visit http://localhost:3000 (logged out) to see landing page
- Banner should not appear immediately (wait for delayed animation)
  </verify>
  <done>
- InstallBanner component renders with platform-appropriate UI
- Banner uses glass-subtle styling and slide-up animation with 2.5s delay
- Landing page includes InstallBanner at bottom
- Dismiss button calls hook's dismiss() to persist preference
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
PWA install banner on landing page with:
- 2.5 second delayed slide-up animation
- Platform detection (iOS shows "Zo werkt het", others show "Installeren")
- iOS walkthrough modal with 3-step instructions
- Dismiss button that permanently hides banner
  </what-built>
  <how-to-verify>
**Test on Desktop (Chrome):**
1. Clear localStorage: DevTools > Application > Storage > Clear site data
2. Visit http://localhost:3000 (ensure logged out)
3. Wait ~3 seconds - banner should slide up from bottom
4. Verify banner shows "Installeren" button (Chromium platform)
5. Click dismiss ("Niet nu") - banner should disappear
6. Refresh page - banner should NOT reappear (dismissed permanently)

**Test iOS behavior (use DevTools mobile emulation):**
1. Clear localStorage again
2. Open DevTools > Toggle Device Toolbar > Select iPhone
3. In Network conditions, set User Agent to Safari iOS
4. Refresh page, wait for banner
5. Verify banner shows "Zo werkt het" button
6. Click "Zo werkt het" - walkthrough modal should open
7. Verify 3 steps with Dutch text are visible
8. Close modal (X button) - banner should still be visible
9. Click "Niet nu" on banner - banner dismisses permanently

**Visual checks:**
- Banner has subtle glass styling (not harsh solid background)
- Animation is smooth slide-up (not instant)
- Touch targets are appropriately sized
- Safe area padding works (bottom padding on iPhone frame)
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
- [ ] `npm run lint` passes
- [ ] `npm run build` succeeds
- [ ] Banner appears on landing page after delay
- [ ] Platform detection shows correct button text
- [ ] iOS walkthrough modal opens and closes correctly
- [ ] Dismiss persists across page refreshes
- [ ] Banner respects safe area on mobile
</verification>

<success_criteria>
1. Landing page shows install banner after 2.5s delay for non-dismissed visitors
2. Banner shows "Installeren" on Chromium, "Zo werkt het" on iOS
3. iOS walkthrough displays 3-step Dutch instructions with recognizable icons
4. Chromium install button triggers native beforeinstallprompt (if available)
5. Dismiss button permanently hides banner via localStorage + database backup
6. All requirements covered: BANR-01, BANR-03, BANR-04, IOS-01, IOS-02, IOS-03, ANDR-01, ANDR-02
</success_criteria>

<output>
After completion, create `.planning/phases/14-landing-page-install/14-01-SUMMARY.md`
</output>
