---
phase: 13-install-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
  - src/types/index.ts
autonomous: true

must_haves:
  truths:
    - "User model has installPromptDismissed field (boolean, default false)"
    - "User model has pwaInstalled field (boolean, default false)"
    - "BeforeInstallPromptEvent interface exists in TypeScript"
    - "Navigator interface extended with standalone property"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "PWA tracking fields on User model"
      contains: "installPromptDismissed"
    - path: "src/types/index.ts"
      provides: "PWA event type definitions"
      contains: "BeforeInstallPromptEvent"
  key_links:
    - from: "prisma/schema.prisma"
      to: "database"
      via: "migration"
      pattern: "installPromptDismissed.*Boolean.*@default\\(false\\)"
---

<objective>
Add database schema fields and TypeScript types for PWA install infrastructure.

Purpose: Establish the data layer foundation that the API and context provider will use for dismissal persistence and installation tracking.
Output: Prisma schema with new User fields, TypeScript interfaces for PWA browser events.
</objective>

<execution_context>
@/home/pvdochtend/.claude/get-shit-done/workflows/execute-plan.md
@/home/pvdochtend/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-install-infrastructure/13-CONTEXT.md
@.planning/phases/13-install-infrastructure/13-RESEARCH.md

@prisma/schema.prisma
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PWA fields to User schema</name>
  <files>prisma/schema.prisma</files>
  <action>
Add two fields to the User model in prisma/schema.prisma:

```prisma
installPromptDismissed  Boolean  @default(false) @map("install_prompt_dismissed")
pwaInstalled            Boolean  @default(false) @map("pwa_installed")
```

Place them after the existing `darkMode` field, before the `createdAt` field, to group user preferences together.

After editing the schema, create a migration:
```bash
npx prisma migrate dev --name add_pwa_install_fields
```

Then regenerate the Prisma client:
```bash
npx prisma generate
```
  </action>
  <verify>
1. Run `npx prisma validate` - should pass with no errors
2. Check migration file exists in prisma/migrations/ with correct SQL
3. Run `npx prisma studio` and verify User model shows new columns
  </verify>
  <done>
- User model has `installPromptDismissed Boolean @default(false)`
- User model has `pwaInstalled Boolean @default(false)`
- Migration created and applied successfully
- Prisma client regenerated
  </done>
</task>

<task type="auto">
  <name>Task 2: Add PWA TypeScript types</name>
  <files>src/types/index.ts</files>
  <action>
Add a new section to src/types/index.ts for PWA types:

```typescript
// ════════════════════════════════════
// PWA TYPES
// ════════════════════════════════════

/**
 * Browser event fired when PWA is installable (Chromium only)
 * @see https://developer.mozilla.org/en-US/docs/Web/API/BeforeInstallPromptEvent
 */
export interface BeforeInstallPromptEvent extends Event {
  readonly platforms: string[]
  readonly userChoice: Promise<{
    outcome: 'accepted' | 'dismissed'
    platform: string
  }>
  prompt(): Promise<{
    outcome: 'accepted' | 'dismissed'
  }>
}

/**
 * Platform detection result for PWA install flow
 */
export type PwaPlatform = 'ios' | 'chromium' | 'unsupported'

// Extend global types for PWA browser APIs
declare global {
  interface WindowEventMap {
    beforeinstallprompt: BeforeInstallPromptEvent
    appinstalled: Event
  }
  interface Navigator {
    /** iOS Safari standalone mode indicator */
    standalone?: boolean
  }
}
```

Place this section after the existing THEME TYPES section.
  </action>
  <verify>
1. Run `npx tsc --noEmit` - should compile without TypeScript errors
2. Check that `BeforeInstallPromptEvent` can be imported: `import { BeforeInstallPromptEvent } from '@/types'`
  </verify>
  <done>
- BeforeInstallPromptEvent interface exported from @/types
- PwaPlatform type exported from @/types
- WindowEventMap extended with beforeinstallprompt and appinstalled
- Navigator interface extended with standalone property
- TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
1. `npx prisma validate` passes
2. `npx tsc --noEmit` passes
3. Migration exists and is applied
4. New types are importable from @/types
</verification>

<success_criteria>
- Database has installPromptDismissed and pwaInstalled columns on users table
- TypeScript types for PWA browser events are available for use by context provider
- No breaking changes to existing functionality
- All existing tests still pass: `npm test`
</success_criteria>

<output>
After completion, create `.planning/phases/13-install-infrastructure/13-01-SUMMARY.md`
</output>
