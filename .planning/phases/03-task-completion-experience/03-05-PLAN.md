---
phase: 03-task-completion-experience
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/tasks/today-task-item.tsx
  - src/app/globals.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Task returns to normal appearance after mobile tap (no sticky selection)"
    - "Hover styles only apply on devices with true hover capability"
    - "Focus ring only shows for keyboard navigation, not touch"
  artifacts:
    - path: "src/components/tasks/today-task-item.tsx"
      provides: "Mobile-friendly touch state handling"
      contains: "@media (hover: hover)"
  key_links:
    - from: "hover:bg-accent"
      to: "@media (hover: hover)"
      via: "media query wrapper"
      pattern: "@media.*hover.*hover"
---

<objective>
Fix mobile touch states so tasks don't stay selected/highlighted after tap.

Purpose: On mobile, hover states stick after tap because there's no mouseout event. Fix by scoping hover styles to devices with true hover capability.
Output: Clean touch experience - tap completes task, task returns to normal appearance.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-task-completion-experience/03-UAT.md

Relevant source files:
@src/components/tasks/today-task-item.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scope hover styles to devices with true hover capability</name>
  <files>src/app/globals.css</files>
  <action>
Add a utility class that only applies hover styles on devices with actual hover capability (mouse/trackpad, not touch):

```css
/* Mobile-friendly hover - only applies on devices with true hover */
@media (hover: hover) and (pointer: fine) {
  .hover-capable:hover {
    /* Hover styles go here */
  }
}

/* Or create a general pattern for task items */
@layer utilities {
  @media (hover: hover) and (pointer: fine) {
    .task-item-hover:hover {
      @apply bg-accent shadow-md;
    }
  }
}
```

Also add tap highlight removal for cleaner mobile experience:
```css
/* Remove tap highlight on touch devices */
.touch-target {
  -webkit-tap-highlight-color: transparent;
}
```

The `touch-target` class is already used on task items, so this will apply automatically.
  </action>
  <verify>
- npm run build succeeds
- CSS is valid
  </verify>
  <done>Hover styles scoped to devices with true hover capability</done>
</task>

<task type="auto">
  <name>Task 2: Update TodayTaskItem to use mobile-friendly hover</name>
  <files>src/components/tasks/today-task-item.tsx</files>
  <action>
Replace the direct hover:bg-accent class with a hover-only-on-capable approach:

1. Find the button className that has `hover:bg-accent`:
```tsx
'hover:bg-accent hover:shadow-md active:scale-[0.98]',
```

2. Option A - Use @media query in Tailwind arbitrary variant:
```tsx
'[@media(hover:hover)]:hover:bg-accent [@media(hover:hover)]:hover:shadow-md active:scale-[0.98]',
```

3. Option B - If that's too verbose, use the CSS class from Task 1:
```tsx
'task-item-hover active:scale-[0.98]',
```
And handle the hover styles entirely in CSS.

4. Also add focus-visible for keyboard accessibility (not :focus):
```tsx
'focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2',
```
This shows focus ring only for keyboard navigation, not touch/click.

5. Optionally blur the button after click to clear any lingering focus:
```tsx
const handleToggle = async () => {
  // Blur to clear focus state after interaction
  buttonRef.current?.blur()

  // ... rest of handler
}
```
  </action>
  <verify>
- npm run build succeeds
- npm run lint passes
  </verify>
  <done>Task items don't show sticky hover/focus on mobile after tap</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fixed mobile touch states - hover only on capable devices, focus-visible for keyboard only, blur after tap</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open browser DevTools â†’ Toggle device toolbar (mobile view)
    3. Select a phone preset (e.g., iPhone 14 Pro)
    4. Navigate to /vandaag (log in if needed)
    5. Tap a task to complete it
    6. Observe: Task should NOT stay highlighted/selected after tap
    7. Tap completed task again to uncomplete
    8. Observe: Task returns to normal appearance
    9. Also test: On desktop, hover still works (highlight on mouse over)
    10. Also test: Tab through tasks with keyboard - focus ring should appear
  </how-to-verify>
  <resume-signal>Type "approved" or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes without errors
- [ ] Mobile: No sticky hover/focus after tap
- [ ] Desktop: Hover still works on mouse over
- [ ] Keyboard: Focus ring shows when tabbing
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- User approved mobile touch behavior
- Task items return to normal state after mobile tap
- No accessibility regression (keyboard focus still works)
</success_criteria>

<output>
After completion, create `.planning/phases/03-task-completion-experience/03-05-SUMMARY.md`
</output>
