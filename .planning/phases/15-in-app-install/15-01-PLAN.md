---
phase: 15-in-app-install
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(main)/layout.tsx
  - src/components/pwa/install-settings-card.tsx
  - src/app/(main)/instellingen/page.tsx
autonomous: false

must_haves:
  truths:
    - "Logged-in user sees install banner on main app pages"
    - "Settings page shows install card between Account and Daily Target"
    - "Settings install button works even after banner was dismissed"
    - "Settings button triggers platform-appropriate action (prompt or walkthrough)"
  artifacts:
    - path: "src/components/pwa/install-settings-card.tsx"
      provides: "Settings card component with install button"
      min_lines: 30
    - path: "src/app/(main)/layout.tsx"
      provides: "InstallBanner integration in main layout"
      contains: "InstallBanner"
    - path: "src/app/(main)/instellingen/page.tsx"
      provides: "InstallSettingsCard integration"
      contains: "InstallSettingsCard"
  key_links:
    - from: "src/app/(main)/layout.tsx"
      to: "src/components/pwa/install-banner.tsx"
      via: "import and render"
      pattern: "import.*InstallBanner"
    - from: "src/components/pwa/install-settings-card.tsx"
      to: "src/contexts/pwa-install-context.tsx"
      via: "usePwaInstall hook"
      pattern: "usePwaInstall"
    - from: "src/app/(main)/instellingen/page.tsx"
      to: "src/components/pwa/install-settings-card.tsx"
      via: "import and render"
      pattern: "import.*InstallSettingsCard"
---

<objective>
Add PWA install access for logged-in users via in-app banner and settings card.

Purpose: Users who missed the landing page banner or dismissed it can still install the app from within the authenticated experience.
Output: InstallBanner on main app pages + InstallSettingsCard on settings page
</objective>

<execution_context>
@/home/pvdochtend/.claude/get-shit-done/workflows/execute-plan.md
@/home/pvdochtend/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-in-app-install/15-CONTEXT.md
@.planning/phases/15-in-app-install/15-RESEARCH.md
@.planning/phases/14-landing-page-install/14-01-SUMMARY.md

# Key source files
@src/contexts/pwa-install-context.tsx
@src/components/pwa/install-banner.tsx
@src/components/pwa/ios-walkthrough-modal.tsx
@src/app/(main)/layout.tsx
@src/app/(main)/instellingen/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add InstallBanner to main layout</name>
  <files>src/app/(main)/layout.tsx</files>
  <action>
Import InstallBanner from '@/components/pwa/install-banner' and render it between the main content and BottomNav.

The component handles its own visibility logic via usePwaInstall (canInstall, isDismissed, isStandalone). No props needed.

Position: After `</main>` closing tag, before `<BottomNav />`.

The existing z-index (z-40 on banner, z-50 on BottomNav) ensures correct layering.
  </action>
  <verify>
1. `npm run build` succeeds
2. Visit `/vandaag` in iOS Safari simulator or Chrome DevTools mobile mode
3. Banner appears at bottom of page after 2.5s delay (if not previously dismissed)
  </verify>
  <done>
InstallBanner renders on all main app pages (Vandaag, Inzichten, Taken, Instellingen) with correct positioning below BottomNav.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create InstallSettingsCard component</name>
  <files>src/components/pwa/install-settings-card.tsx</files>
  <action>
Create a new client component that provides permanent install access regardless of banner dismissal.

Key implementation details:
- Use usePwaInstall hook for platform, isStandalone, isLoading, triggerInstall
- DO NOT check isDismissed or canInstall - settings card bypasses banner dismissal
- Show card when: !isLoading && !isStandalone && platform !== 'unsupported'
- Manage own showWalkthrough state for iOS modal (don't call dismiss())
- Use Smartphone icon from lucide-react for consistent "app" messaging

Card styling:
- Match existing settings cards: `glass animate-slide-up hover-lift shadow-sm`
- Use Card, CardHeader, CardTitle, CardDescription, CardContent from @/components/ui/card
- Button with `w-full touch-target` classes

Dutch copy:
- Title: "Installeer de app"
- Description: "Open HabitStreak direct vanaf je startscherm"
- Button text: "Voeg toe aan beginscherm" (iOS) or "Installeren" (Chromium)

Handle install action:
- iOS: setShowWalkthrough(true)
- Chromium: await triggerInstall() (result handling optional - card stays visible until isStandalone)
  </action>
  <verify>
1. File exists at src/components/pwa/install-settings-card.tsx
2. `npm run build` succeeds (no TypeScript errors)
3. Component exports InstallSettingsCard
  </verify>
  <done>
InstallSettingsCard component created with platform-specific button text, own walkthrough state management, and visibility logic that bypasses banner dismissal.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate InstallSettingsCard into settings page</name>
  <files>src/app/(main)/instellingen/page.tsx</files>
  <action>
Import InstallSettingsCard and render it between the Account card and Daily Target card.

Position in JSX:
```
{/* Account Info */}
<Card className="glass animate-slide-up hover-lift shadow-sm">
  {/* ... existing content ... */}
</Card>

{/* Install App Card - shows when app is installable */}
<InstallSettingsCard />

{/* Daily Target Settings */}
<Card className="glass animate-slide-up hover-lift shadow-sm">
  {/* ... existing content ... */}
</Card>
```

The component handles its own visibility (returns null when installed or unsupported).
  </action>
  <verify>
1. `npm run build` succeeds
2. Visit `/instellingen` in iOS Safari simulator - card appears between Account and Daily Target
3. Visit `/instellingen` in Chrome DevTools (Android mode) - card appears with different button text
4. Card disappears when viewing in standalone/PWA mode
  </verify>
  <done>
Settings page shows InstallSettingsCard between Account and Daily Target sections, with platform-appropriate button text and proper visibility logic.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>In-app PWA install banner and settings card with platform-specific behavior</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open http://localhost:3000 and log in

**Test in-app banner (iOS Safari or Chrome mobile mode):**
3. Navigate to /vandaag - banner should appear at bottom after 2.5s delay
4. Navigate to /inzichten, /taken, /instellingen - banner persists across pages
5. Click dismiss (X) - banner disappears and stays dismissed

**Test settings card:**
6. Navigate to /instellingen
7. Card should appear between Account and Daily Target sections
8. Card should still be visible even though banner was dismissed
9. Button text should match platform:
   - iOS: "Voeg toe aan beginscherm"
   - Android/Chromium: "Installeren"
10. Click button:
    - iOS: Walkthrough modal opens
    - Chromium: Native install prompt appears (if service worker present)

**Expected behavior:**
- Banner respects dismissal state
- Settings card ignores dismissal state (permanent fallback)
- Both hidden when app is installed (standalone mode)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] Build succeeds: `npm run build`
- [ ] In-app banner appears on main pages after 2.5s delay
- [ ] Banner dismissal persists across pages
- [ ] Settings card appears between Account and Daily Target
- [ ] Settings card visible even after banner dismissed
- [ ] Platform-specific button text (iOS vs Chromium)
- [ ] iOS walkthrough modal works from settings card
- [ ] All UI hidden when app already installed (standalone)
</verification>

<success_criteria>
1. BANR-02: Logged-in users see install banner on main app pages
2. SETT-01: Settings page shows install card in correct position
3. SETT-02: Settings install button works after banner dismissed
4. SETT-03: Button triggers platform-appropriate action
</success_criteria>

<output>
After completion, create `.planning/phases/15-in-app-install/15-01-SUMMARY.md`
</output>
