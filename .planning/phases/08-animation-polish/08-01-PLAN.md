---
phase: 08-animation-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/globals.css
  - src/components/tasks/today-task-item.tsx
autonomous: false

must_haves:
  truths:
    - "User can see flame icon flicker noticeably on Inzichten page"
    - "User can see flame glow pulse around the icon"
    - "No visual blink occurs when completing a task on Vandaag page"
    - "Users with prefers-reduced-motion see static flame"
  artifacts:
    - path: "src/app/globals.css"
      provides: "Enhanced flame animations and fixed glow animation"
      contains: "@keyframes flameFlicker"
    - path: "src/components/tasks/today-task-item.tsx"
      provides: "Task completion without visual blink"
      contains: "animate-glow"
  key_links:
    - from: "animated-flame.tsx"
      to: "globals.css flameFlicker/flameGlow"
      via: "animate-flame-flicker and animate-flame-glow classes"
      pattern: "animate-flame-flicker|animate-flame-glow"
    - from: "today-task-item.tsx animate-glow removal"
      to: "shadow-sm appearance"
      via: "transition-all on button"
      pattern: "transition.*duration"
---

<objective>
Polish animation visibility and fix visual blink on task completion.

Purpose: Make flame animation clearly visible on mobile screens and eliminate the visual blink when completing tasks — delivering on the "rewarding interaction" core value.

Output: Enhanced CSS animations with bolder effects and fixed state transitions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Debug research (root causes already diagnosed):
@.planning/debug/animate-glow-blink-on-check.md
@.planning/todos/pending/2026-01-18-flame-animation-too-subtle.md

# Source files to modify:
@src/app/globals.css
@src/components/tasks/today-task-item.tsx
@src/components/insights/animated-flame.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance flame animation visibility</name>
  <files>src/app/globals.css</files>
  <action>
    Update the flameFlicker and flameGlow keyframes to be more visible on mobile:

    **flameFlicker improvements:**
    - Increase scale range from 1.0-1.05 to 0.9-1.15 for more noticeable pulse
    - Increase rotation from ±2deg to ±4deg for livelier movement
    - Add slight y-translate (-2px to 2px) for dancing effect
    - Reduce duration from 1.5s to 1.2s for more energetic feel

    **flameGlow improvements:**
    - Increase drop-shadow opacity from 0.3/0.5 to 0.5/0.8
    - Increase blur radius from 2px/6px to 4px/10px for more visible glow
    - Add orange-500 color explicitly (rgb(249, 115, 22)) for consistency
    - Reduce duration from 2s to 1.5s to sync better with flicker

    **IMPORTANT:** Preserve the @media (prefers-reduced-motion: reduce) block that disables these animations — do NOT modify that section.
  </action>
  <verify>npm run lint passes, CSS is valid</verify>
  <done>flameFlicker and flameGlow animations have bolder, more visible effects</done>
</task>

<task type="auto">
  <name>Task 2: Fix animate-glow blink on task completion</name>
  <files>src/app/globals.css, src/components/tasks/today-task-item.tsx</files>
  <action>
    Fix the visual blink that occurs when animate-glow class is removed after task completion.

    **Root cause (from debug research):**
    - Task completion adds shadow-sm (box-shadow: 0 1px 2px...)
    - animate-glow overrides this with its box-shadow animation
    - Animation ends at box-shadow: 0 0 0 0 (transparent)
    - When animate-glow is removed, transition-all animates from "no shadow" to shadow-sm
    - This 500ms transition creates the visible blink

    **Fix approach — exclude box-shadow from transition:**
    In today-task-item.tsx, change the button's transition property from `transition-all` to explicitly list only the properties we want to transition:
    - `transition-[background-color,border-color,transform,opacity]` — already correct on line 89

    Wait, looking at line 89, it already has the specific transition. The issue is that `shadow-sm` is being applied at the same time as `animate-glow`, and when `animate-glow` ends, the shadow-sm snaps in.

    **Better fix — remove shadow-sm from completed state:**
    In today-task-item.tsx line 92, remove `shadow-sm` from the completed state styling. The glow animation provides sufficient visual feedback during completion. Completed tasks don't need an additional drop shadow.

    Change line 92 from:
    `? 'bg-primary/5 border-primary shadow-sm'`
    to:
    `? 'bg-primary/5 border-primary'`

    This eliminates the conflict entirely — no shadow-sm means nothing to transition to after glow ends.
  </action>
  <verify>npm run lint passes, TypeScript compiles</verify>
  <done>No visual blink occurs when completing a task</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Enhanced flame animation (bolder flicker and glow) and fixed the visual blink on task completion.
  </what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/inzichten
    3. **Flame visibility test:**
       - Look at the flame icon next to the streak count
       - Verify the flame has a noticeable flicker/dance effect
       - Verify there's a visible orange glow pulsing around the flame
       - Compare to before: animation should be clearly visible, not subtle
    4. **Mobile simulation:**
       - Open DevTools → Toggle device toolbar (Ctrl+Shift+M)
       - Select iPhone 12 Pro or similar mobile device
       - Verify flame animation is visible at mobile viewport size
    5. Visit: http://localhost:3000/vandaag
    6. **Blink test:**
       - Find an uncompleted task
       - Complete the task by tapping/clicking
       - Watch carefully for any visual blink/flash after ~1 second
       - Should see: smooth glow animation → clean end, no blink
    7. **Reduced motion test:**
       - Open DevTools → Rendering panel → Emulate CSS media feature: prefers-reduced-motion: reduce
       - Verify flame is static (no animation)
       - Verify task completion has no glow animation
  </how-to-verify>
  <resume-signal>Type "approved" if animations are visibly improved and blink is fixed, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run lint passes
- [ ] npm run build succeeds
- [ ] Flame animation is visibly bolder on /inzichten
- [ ] No blink occurs on task completion on /vandaag
- [ ] prefers-reduced-motion disables animations
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- ANIM-01 satisfied: Flame glow opacity increased for visibility
- ANIM-02 satisfied: No blink from shadow-sm conflict
- ANIM-03 satisfied: prefers-reduced-motion support maintained
</success_criteria>

<output>
After completion, create `.planning/phases/08-animation-polish/08-01-SUMMARY.md`
</output>
