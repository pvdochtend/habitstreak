---
phase: 04-celebrations-and-streaks
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/insights/animated-streak-number.tsx
  - src/components/insights/animated-flame.tsx
  - src/components/insights/streak-card.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "User sees number roll animation when streak count increases"
    - "User sees flickering flame icon when streak is active (> 0)"
    - "Animations respect prefers-reduced-motion setting"
  artifacts:
    - path: "src/components/insights/animated-streak-number.tsx"
      provides: "Number rolling component"
      min_lines: 30
      exports: ["AnimatedStreakNumber"]
    - path: "src/components/insights/animated-flame.tsx"
      provides: "Animated flame icon"
      min_lines: 20
      exports: ["AnimatedFlame"]
    - path: "src/app/globals.css"
      provides: "CSS keyframes for animations"
      contains: "@keyframes"
  key_links:
    - from: "streak-card.tsx"
      to: "AnimatedStreakNumber"
      via: "Render streak value with animation"
      pattern: "<AnimatedStreakNumber"
    - from: "streak-card.tsx"
      to: "AnimatedFlame"
      via: "Render flame with active state"
      pattern: "<AnimatedFlame.*isActive"
    - from: "AnimatedStreakNumber"
      to: "globals.css keyframes"
      via: "Apply CSS animations"
      pattern: "transition-transform"
---

<objective>
Add animated streak counter with number rolling and flickering flame icon for active streaks.

Purpose: Make streak progress feel dynamic and alive - numbers should roll when changing, flame should flicker when active, creating visual interest on the insights page.
Output: AnimatedStreakNumber component with CSS-based digit rolling, AnimatedFlame component with flicker/glow effects, integrated into existing StreakCard.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing streak card to enhance
@src/components/insights/streak-card.tsx

# Research findings with pure CSS patterns
@.planning/phases/04-celebrations-and-streaks/04-RESEARCH.md

# Conventions - CSS in globals.css
@.planning/codebase/CONVENTIONS.md

# Existing globals.css for new keyframes
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnimatedStreakNumber component with CSS rolling</name>
  <files>src/components/insights/animated-streak-number.tsx</files>
  <action>
Create AnimatedStreakNumber component using pure CSS translateY approach from research.

Interface:
```typescript
interface AnimatedStreakNumberProps {
  value: number;
  previousValue?: number;
}
```

Implementation:
1. Accept value and previousValue props
2. Determine shouldAnimate = previousValue !== undefined && value !== previousValue
3. Render digit roller:
   - Container: `relative h-[1em] overflow-hidden inline-block`
   - Stack: `flex flex-col` with 0-9 digits
   - Transform: `translateY(-${value * 1}em)` to show current digit
   - Transition: `transition-transform duration-500 ease-out` when shouldAnimate
4. Each digit: `h-[1em] leading-none flex items-center justify-center`
5. Handle multi-digit numbers: Map each digit separately if value >= 10

Why pure CSS:
- No library needed
- GPU-accelerated transforms
- Works universally
- Easy to add prefers-reduced-motion support in CSS

Anti-pattern avoided: Don't use @property CSS counters (Chrome-only). Don't animate on initial render (previousValue check prevents this).

Note: Start with 0-99 support (typical streak range). If needed later, can enhance for 100+ with per-digit rollers.
  </action>
  <verify>TypeScript compiles, AnimatedStreakNumber exports properly</verify>
  <done>Component created, renders digits 0-9 in vertical stack, translateY based on value prop</done>
</task>

<task type="auto">
  <name>Task 2: Create AnimatedFlame component with CSS flicker</name>
  <files>src/components/insights/animated-flame.tsx</files>
  <action>
Create AnimatedFlame component wrapping Lucide Flame icon with CSS animations.

Interface:
```typescript
interface AnimatedFlameProps {
  isActive: boolean;
  className?: string;
}
```

Implementation:
1. Import Flame from 'lucide-react'
2. Import cn from '@/lib/utils'
3. Apply animations when isActive:
   - Icon: `animate-flame-flicker text-orange-500` (will define in CSS)
   - Container: `animate-flame-glow` for subtle glow effect
4. When not active: `text-muted-foreground` (gray, no animation)
5. Base icon props: `className="h-6 w-6" strokeWidth={2.5}` (match existing StreakCard)

Why this approach:
- Lucide Flame already in use (src/components/insights/streak-card.tsx line 26)
- Pure CSS animations (no library)
- Conditional animation based on isActive prop
- Respects reduced motion via CSS @media query

Anti-pattern avoided: Don't use filter: blur() (expensive). Use transform + opacity only, with light drop-shadow for glow.
  </action>
  <verify>TypeScript compiles, AnimatedFlame exports properly, accepts isActive prop</verify>
  <done>Component created, renders Flame icon with conditional animations based on isActive</done>
</task>

<task type="auto">
  <name>Task 3: Add CSS keyframes to globals.css</name>
  <files>src/app/globals.css</files>
  <action>
Add keyframe animations to src/app/globals.css for flame effects.

Add after existing animations (after Phase 2 and Phase 3 animations):

```css
/* ═══════════════════════════════════════════════════════════ */
/* Phase 4: Streak Animations */
/* ═══════════════════════════════════════════════════════════ */

/* Flame flicker animation */
@keyframes flameFlicker {
  0%, 100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
  25% {
    transform: scale(1.05) rotate(-2deg);
    opacity: 0.9;
  }
  50% {
    transform: scale(0.98) rotate(1deg);
    opacity: 1;
  }
  75% {
    transform: scale(1.02) rotate(-1deg);
    opacity: 0.95;
  }
}

.animate-flame-flicker {
  animation: flameFlicker 1.5s ease-in-out infinite;
  transform-origin: bottom center;
}

/* Flame glow effect (subtle) */
@keyframes flameGlow {
  0%, 100% {
    filter: drop-shadow(0 0 2px rgba(249, 115, 22, 0.3));
  }
  50% {
    filter: drop-shadow(0 0 6px rgba(249, 115, 22, 0.5));
  }
}

.animate-flame-glow {
  animation: flameGlow 2s ease-in-out infinite;
}

/* Reduced motion: disable all Phase 4 animations */
@media (prefers-reduced-motion: reduce) {
  .animate-flame-flicker,
  .animate-flame-glow {
    animation: none !important;
  }

  /* Number rolling transitions become instant */
  .transition-transform {
    transition-duration: 0s !important;
  }
}
```

Why this implementation:
- flameFlicker uses scale + rotate + opacity (GPU-accelerated, no expensive filters)
- flameGlow uses drop-shadow (lighter than blur)
- transform-origin: bottom center anchors flame at base (natural flicker)
- Staggered timing: flicker 1.5s, glow 2s (creates organic feel)
- Reduced motion support for accessibility

Colors: rgba(249, 115, 22, X) is orange-500 from Tailwind (matches existing orange theme in StreakCard).
  </action>
  <verify>CSS syntax is valid, file compiles without errors</verify>
  <done>Keyframes added to globals.css with proper reduced motion support</done>
</task>

<task type="auto">
  <name>Task 4: Integrate animations into existing StreakCard</name>
  <files>src/components/insights/streak-card.tsx</files>
  <action>
Update StreakCard component to use new animated components.

Changes:
1. Import new components:
   ```typescript
   import { AnimatedStreakNumber } from './animated-streak-number'
   import { AnimatedFlame } from './animated-flame'
   ```

2. Track previous value with usePrevious:
   ```typescript
   import { usePrevious } from '@/lib/hooks'

   const prevValue = usePrevious(value);
   ```

3. Replace static number display (lines 35-37) with AnimatedStreakNumber:
   ```typescript
   <p className="text-2xl font-bold mt-1">
     <AnimatedStreakNumber value={value} previousValue={prevValue} />{' '}
     <span className="text-lg font-normal text-muted-foreground">
       {value === 1 ? 'dag' : 'dagen'}
     </span>
   </p>
   ```

4. Replace static Flame icon (lines 25-27) with AnimatedFlame (only for current streak):
   ```typescript
   {isCurrent ? (
     <AnimatedFlame isActive={value > 0} />
   ) : (
     <Trophy className="h-6 w-6" strokeWidth={2.5} />
   )}
   ```

Why these changes:
- AnimatedStreakNumber shows roll animation when value changes
- AnimatedFlame flickers only when current streak is active (value > 0)
- Best streak keeps static Trophy icon (no animation)
- usePrevious enables transition detection
- Minimal changes to existing component

Anti-pattern avoided: Don't remove existing className/styling from icon container - keep gradient backgrounds, hover effects.
  </action>
  <verify>
npm run build succeeds
Component renders without errors
AnimatedStreakNumber displays current value
AnimatedFlame shows when current streak > 0
  </verify>
  <done>
StreakCard uses AnimatedStreakNumber and AnimatedFlame
Number rolls when value changes
Flame flickers when active
Build succeeds with no TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 5: Test animations on insights page</name>
  <files>src/components/insights/streak-card.tsx</files>
  <action>
Manual testing to verify animations work correctly:

1. Start dev server: npm run dev
2. Navigate to /inzichten
3. Test scenarios:
   - View current streak with value > 0 → flame should flicker
   - View current streak with value = 0 → flame should be static gray
   - Complete tasks to increase streak → number should roll up
   - View best streak → no flame animation (Trophy icon instead)
4. Test accessibility:
   - Enable "Reduce motion" in OS settings
   - Reload page → flame animations should stop
   - Number changes should be instant (no rolling)
5. Check browser console for errors
6. Verify animations feel smooth (no jank)

Expected behavior:
- Flame flickers subtly with scale/rotate (1.5s cycle)
- Glow pulses gently (2s cycle)
- Number rolls smoothly when streak increases (0.5s duration)
- Animations disabled with prefers-reduced-motion
- No performance issues on mobile

If animations feel too fast/slow/intense, adjust timing in globals.css before completing.

Timing reference from research:
- flameFlicker: 1.5s (subtle, organic feel)
- flameGlow: 2s (gentle pulse)
- Number roll: 0.5s with ease-out (snappy but not jarring)
  </action>
  <verify>All test scenarios pass, animations feel good, no console errors</verify>
  <done>Streak animations work correctly, feel polished, respect accessibility preferences</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] TypeScript compiles without errors
- [ ] AnimatedStreakNumber component exists and works
- [ ] AnimatedFlame component exists and works
- [ ] CSS keyframes added to globals.css
- [ ] StreakCard integrates both components
- [ ] Flame flickers when current streak > 0
- [ ] Number rolls when streak value changes
- [ ] Animations disabled with prefers-reduced-motion
- [ ] Manual testing confirms smooth, polished feel
</verification>

<success_criteria>

- All tasks completed
- AnimatedStreakNumber implements pure CSS rolling
- AnimatedFlame wraps Flame icon with flicker/glow
- CSS keyframes added with reduced motion support
- StreakCard uses both animated components
- Current streak flame flickers when active
- Streak number rolls on value change
- Build succeeds with no errors
- Animations feel smooth and polished
  </success_criteria>

<output>
After completion, create `.planning/phases/04-celebrations-and-streaks/04-02-SUMMARY.md`
</output>
