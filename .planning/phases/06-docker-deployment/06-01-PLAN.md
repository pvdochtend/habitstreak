---
phase: 06-docker-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - next.config.js
  - src/app/api/health/route.ts
  - .dockerignore
autonomous: true

must_haves:
  truths:
    - "next.config.js includes output: 'standalone'"
    - "/api/health endpoint returns 200 with status JSON"
    - ".dockerignore excludes node_modules, .git, .next, .env files"
  artifacts:
    - path: "next.config.js"
      provides: "Standalone output configuration for Docker"
      contains: "output: 'standalone'"
    - path: "src/app/api/health/route.ts"
      provides: "Health check endpoint"
      exports: ["GET"]
    - path: ".dockerignore"
      provides: "Docker build exclusions"
      min_lines: 10
  key_links:
    - from: "next.config.js"
      to: "Docker build"
      via: "standalone output enables minimal image"
---

<objective>
Prepare Next.js app for Docker containerization.

Purpose: Configure standalone output for minimal image size and add health endpoint for container orchestration.
Output: Modified next.config.js, new /api/health endpoint, .dockerignore file.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/SUMMARY.md

@next.config.js
@src/app/api/auth/[...nextauth]/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add standalone output to next.config.js</name>
  <files>next.config.js</files>
  <action>
    Add `output: 'standalone'` to next.config.js.

    This reduces Docker image from 1GB+ to ~200MB by including only necessary files.
    Place it at the top level of the config object, after reactStrictMode.

    The standalone output creates a minimal .next/standalone directory with:
    - Only required node_modules (no devDependencies)
    - Compiled application code
    - A server.js entry point
  </action>
  <verify>npm run build completes successfully and .next/standalone directory exists</verify>
  <done>next.config.js has output: 'standalone' and build creates standalone directory</done>
</task>

<task type="auto">
  <name>Task 2: Create /api/health endpoint</name>
  <files>src/app/api/health/route.ts</files>
  <action>
    Create a health check endpoint at /api/health that:

    1. Returns 200 status code for healthy container
    2. Returns JSON with status, timestamp, and version info
    3. Does NOT require authentication (public endpoint for orchestration)
    4. Does NOT check database (keep it fast for frequent polling)

    Response format:
    ```json
    {
      "status": "healthy",
      "timestamp": "2026-01-18T12:00:00.000Z",
      "version": "1.1.0"
    }
    ```

    Use NextResponse.json() pattern consistent with other API routes.
    Import version from package.json if possible, or hardcode "1.1.0".
  </action>
  <verify>curl http://localhost:3000/api/health returns 200 with JSON body</verify>
  <done>/api/health returns 200 with status JSON without authentication</done>
</task>

<task type="auto">
  <name>Task 3: Create .dockerignore</name>
  <files>.dockerignore</files>
  <action>
    Create .dockerignore to exclude unnecessary files from Docker build context:

    ```
    # Dependencies (will be installed in container)
    node_modules

    # Build artifacts (will be generated in container)
    .next
    out

    # Git
    .git
    .gitignore

    # Environment (secrets - must not be in image)
    .env
    .env.*
    !.env.example
    !.env.production.example

    # IDE
    .vscode
    .idea
    *.swp

    # Testing
    coverage
    playwright-report
    test-results

    # Development
    .planning
    tests
    *.md
    !README.md

    # Docker
    Dockerfile*
    docker-compose*.yml
    .docker
    ```

    This ensures:
    - Fast builds (smaller context)
    - No secrets in image
    - No dev artifacts in production
  </action>
  <verify>.dockerignore file exists and contains node_modules, .next, .env exclusions</verify>
  <done>.dockerignore excludes all dev and secret files from Docker context</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds with standalone output
- [ ] `.next/standalone` directory created after build
- [ ] `/api/health` returns 200 with JSON when dev server running
- [ ] `.dockerignore` file exists with proper exclusions
</verification>

<success_criteria>
- All tasks completed
- Build produces standalone output
- Health endpoint accessible without auth
- .dockerignore properly configured
</success_criteria>

<output>
After completion, create `.planning/phases/06-docker-deployment/06-01-SUMMARY.md`
</output>
